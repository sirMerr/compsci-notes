
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Notes for Semester 5 of Computer Science at Dawson">
      
      
        <link rel="canonical" href="https://sirmerr.github.io/compsci-notes/Internet App Dev III/using_postgres/">
      
      
        <meta name="author" content="Tiffany">
      
      
        <link rel="shortcut icon" href="../../images/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.4">
    
    
      
        <title>Using postgres - CompSci HQ</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-769c285a91.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-02c2a4388f.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="blue-grey" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="https://sirmerr.github.io/compsci-notes/" title="CompSci HQ" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Internet App Dev III
                </span>
              
            
            Using postgres
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    CompSci HQ
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../how-to-document/" title="How to document" class="md-nav__link">
      How to document
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Data and Communications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Data and Communications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Data and Communications/introduction/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Assignments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Assignments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Data and Communications/assignments/stones/" title="Stones" class="md-nav__link">
      Stones
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Internet App Dev III
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Internet App Dev III
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../_References/" title=" References" class="md-nav__link">
       References
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../_String/" title=" String" class="md-nav__link">
       String
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../_Term-definitions/" title=" Term definitions" class="md-nav__link">
       Term definitions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../__Introduction/" title="  Introduction" class="md-nav__link">
        Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../__Outline/" title="  Outline" class="md-nav__link">
        Outline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../arrays/" title="Arrays" class="md-nav__link">
      Arrays
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cURL_DOMDocumentation/" title="cURL DOMDocumentation" class="md-nav__link">
      cURL DOMDocumentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../constructs/" title="Constructs" class="md-nav__link">
      Constructs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../forms/" title="Forms" class="md-nav__link">
      Forms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../midterm_prep/" title="Midterm prep" class="md-nav__link">
      Midterm prep
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Using postgres
      </label>
    
    <a href="./" title="Using postgres" class="md-nav__link md-nav__link--active">
      Using postgres
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#postgres-database" title="Postgres database" class="md-nav__link">
    Postgres database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#once-connected-sql-queries" title="Once connected - SQL queries" class="md-nav__link">
    Once connected - SQL queries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-php-with-postgres" title="Using PHP with Postgres" class="md-nav__link">
    Using PHP with Postgres
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#three-important-pdo-classes" title="Three important PDO classes" class="md-nav__link">
    Three important PDO classes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pdo-db-connection-abstraction" title="PDO – db connection abstraction" class="md-nav__link">
    PDO – db connection abstraction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pdoexception" title="PDOException" class="md-nav__link">
    PDOException
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pdostatement" title="PDOStatement" class="md-nav__link">
    PDOStatement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pdo-php-data-objects" title="PDO- PHP Data Objects" class="md-nav__link">
    PDO- PHP Data Objects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#issue-sql-injection" title="Issue: SQL Injection" class="md-nav__link">
    Issue: SQL Injection
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-injection-another-example" title="SQL Injection – Another example" class="md-nav__link">
    SQL Injection – Another example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-does-it-happen" title="Why does it happen?" class="md-nav__link">
    Why does it happen?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-solution-always-use-prepared-statements" title="Best Solution- ALWAYS use prepared statements" class="md-nav__link">
    Best Solution- ALWAYS use prepared statements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#named-placeholders" title="Named placeholders" class="md-nav__link">
    Named placeholders
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binding-parameters-to-reuse-statements" title="Binding parameters to reuse statements" class="md-nav__link">
    Binding parameters to reuse statements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bindparam-vs-bindvalue" title="bindParam vs bindValue" class="md-nav__link">
    bindParam vs bindValue
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetch-methods-and-styles" title="Fetch methods and styles" class="md-nav__link">
    Fetch methods and styles
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#examples-in-an-array" title="Examples – in an array" class="md-nav__link">
    Examples – in an array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-object" title="Example - object" class="md-nav__link">
    Example - object
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes" title="Notes" class="md-nav__link">
    Notes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#column-name-to-attribute-name-mapping" title="Column name to Attribute name mapping" class="md-nav__link">
    Column name to Attribute name mapping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql-review-inserting-records" title="SQL Review - Inserting records" class="md-nav__link">
    SQL Review - Inserting records
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#named-columns" title="Named columns:" class="md-nav__link">
    Named columns:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unnamed-columns" title="Unnamed columns:" class="md-nav__link">
    Unnamed columns:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-crud-create" title="Example CRUD - Create" class="md-nav__link">
    Example CRUD - Create
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-and-delete-records" title="Update and delete records" class="md-nav__link">
    Update and delete records
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-crud-update" title="Example CRUD - Update" class="md-nav__link">
    Example CRUD - Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-crud-delete" title="Example CRUD - Delete" class="md-nav__link">
    Example CRUD - Delete
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#selecting-data" title="Selecting data" class="md-nav__link">
    Selecting data
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-a-wildcard-in-a-prepared-statement" title="Using a wildcard in a prepared statement:" class="md-nav__link">
    Using a wildcard in a prepared statement:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concatentation-operator" title="Concatentation operator" class="md-nav__link">
    Concatentation operator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" title="Functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sorting" title="Sorting" class="md-nav__link">
    Sorting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grouping-results" title="Grouping results" class="md-nav__link">
    Grouping results
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#distinct" title="Distinct" class="md-nav__link">
    Distinct
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joins" title="Joins" class="md-nav__link">
    Joins
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#types-of-joins" title="Types of joins" class="md-nav__link">
    Types of joins
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inner-join" title="INNER JOIN" class="md-nav__link">
    INNER JOIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outer-join" title="OUTER JOIN:" class="md-nav__link">
    OUTER JOIN:
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#left-join" title="LEFT JOIN" class="md-nav__link">
    LEFT JOIN
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-on-vs-where-conditions" title="JOIN ON vs WHERE conditions" class="md-nav__link">
    JOIN ON vs WHERE conditions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limiting-results" title="Limiting results" class="md-nav__link">
    Limiting results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limit" title="LIMIT" class="md-nav__link">
    LIMIT
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#solution-if-the-order-by-is-sorted-by-unique-keys" title="Solution: If the Order By is sorted by unique keys" class="md-nav__link">
    Solution: If the Order By is sorted by unique keys
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-12" type="checkbox" id="nav-4-12">
    
    <label class="md-nav__link" for="nav-4-12">
      Assignments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-12">
        Assignments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../assignments/dont-eat-that/" title="Dont eat that" class="md-nav__link">
      Dont eat that
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-13" type="checkbox" id="nav-4-13">
    
    <label class="md-nav__link" for="nav-4-13">
      Labs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-13">
        Labs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../labs/getting-started/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../labs/lab2/" title="Lab2" class="md-nav__link">
      Lab2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../labs/lab3/" title="Lab3" class="md-nav__link">
      Lab3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../labs/lab4/" title="Lab4" class="md-nav__link">
      Lab4
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Internship Prep
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Internship Prep
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Internship Prep/dawson/" title="Dawson" class="md-nav__link">
      Dawson
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Mobile Software Dev
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Mobile Software Dev
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Mobile Software Dev/introduction/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Software Dev Project
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Software Dev Project
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Software Dev Project/introduction/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Software Dev Project/jam-specifications/" title="Jam specifications" class="md-nav__link">
      Jam specifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Software Dev Project/logging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Software Dev Project/maven/" title="Maven" class="md-nav__link">
      Maven
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Software Dev Project/outline/" title="Outline" class="md-nav__link">
      Outline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-6" type="checkbox" id="nav-7-6">
    
    <label class="md-nav__link" for="nav-7-6">
      Labs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-6">
        Labs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Software Dev Project/labs/warmup-dice-game/" title="Warmup dice game" class="md-nav__link">
      Warmup dice game
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#postgres-database" title="Postgres database" class="md-nav__link">
    Postgres database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#once-connected-sql-queries" title="Once connected - SQL queries" class="md-nav__link">
    Once connected - SQL queries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-php-with-postgres" title="Using PHP with Postgres" class="md-nav__link">
    Using PHP with Postgres
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#three-important-pdo-classes" title="Three important PDO classes" class="md-nav__link">
    Three important PDO classes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pdo-db-connection-abstraction" title="PDO – db connection abstraction" class="md-nav__link">
    PDO – db connection abstraction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pdoexception" title="PDOException" class="md-nav__link">
    PDOException
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pdostatement" title="PDOStatement" class="md-nav__link">
    PDOStatement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pdo-php-data-objects" title="PDO- PHP Data Objects" class="md-nav__link">
    PDO- PHP Data Objects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#issue-sql-injection" title="Issue: SQL Injection" class="md-nav__link">
    Issue: SQL Injection
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-injection-another-example" title="SQL Injection – Another example" class="md-nav__link">
    SQL Injection – Another example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-does-it-happen" title="Why does it happen?" class="md-nav__link">
    Why does it happen?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-solution-always-use-prepared-statements" title="Best Solution- ALWAYS use prepared statements" class="md-nav__link">
    Best Solution- ALWAYS use prepared statements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#named-placeholders" title="Named placeholders" class="md-nav__link">
    Named placeholders
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binding-parameters-to-reuse-statements" title="Binding parameters to reuse statements" class="md-nav__link">
    Binding parameters to reuse statements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bindparam-vs-bindvalue" title="bindParam vs bindValue" class="md-nav__link">
    bindParam vs bindValue
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetch-methods-and-styles" title="Fetch methods and styles" class="md-nav__link">
    Fetch methods and styles
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#examples-in-an-array" title="Examples – in an array" class="md-nav__link">
    Examples – in an array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-object" title="Example - object" class="md-nav__link">
    Example - object
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes" title="Notes" class="md-nav__link">
    Notes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#column-name-to-attribute-name-mapping" title="Column name to Attribute name mapping" class="md-nav__link">
    Column name to Attribute name mapping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql-review-inserting-records" title="SQL Review - Inserting records" class="md-nav__link">
    SQL Review - Inserting records
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#named-columns" title="Named columns:" class="md-nav__link">
    Named columns:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unnamed-columns" title="Unnamed columns:" class="md-nav__link">
    Unnamed columns:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-crud-create" title="Example CRUD - Create" class="md-nav__link">
    Example CRUD - Create
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-and-delete-records" title="Update and delete records" class="md-nav__link">
    Update and delete records
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-crud-update" title="Example CRUD - Update" class="md-nav__link">
    Example CRUD - Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-crud-delete" title="Example CRUD - Delete" class="md-nav__link">
    Example CRUD - Delete
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#selecting-data" title="Selecting data" class="md-nav__link">
    Selecting data
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-a-wildcard-in-a-prepared-statement" title="Using a wildcard in a prepared statement:" class="md-nav__link">
    Using a wildcard in a prepared statement:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concatentation-operator" title="Concatentation operator" class="md-nav__link">
    Concatentation operator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" title="Functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sorting" title="Sorting" class="md-nav__link">
    Sorting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grouping-results" title="Grouping results" class="md-nav__link">
    Grouping results
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#distinct" title="Distinct" class="md-nav__link">
    Distinct
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joins" title="Joins" class="md-nav__link">
    Joins
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#types-of-joins" title="Types of joins" class="md-nav__link">
    Types of joins
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inner-join" title="INNER JOIN" class="md-nav__link">
    INNER JOIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outer-join" title="OUTER JOIN:" class="md-nav__link">
    OUTER JOIN:
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#left-join" title="LEFT JOIN" class="md-nav__link">
    LEFT JOIN
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-on-vs-where-conditions" title="JOIN ON vs WHERE conditions" class="md-nav__link">
    JOIN ON vs WHERE conditions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limiting-results" title="Limiting results" class="md-nav__link">
    Limiting results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limit" title="LIMIT" class="md-nav__link">
    LIMIT
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#solution-if-the-order-by-is-sorted-by-unique-keys" title="Solution: If the Order By is sorted by unique keys" class="md-nav__link">
    Solution: If the Order By is sorted by unique keys
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Using postgres</h1>
                
                <h2 id="postgres-database">Postgres database<a class="headerlink" href="#postgres-database" title="Permanent link">&para;</a></h2>
<p>PostgreSQL is an open-source object-relational database</p>
<p>used by Instagram, TripAdvisor
installed in Homestead Vagrant box (along with MySQL)
Beware: Postgres SQL is stricter than MySQL!
Documentation: <a href="https://www.postgresql.org/docs/9.4/static/index.html">https://www.postgresql.org/docs/9.4/static/index.html</a></p>
<p>Using psql Client
psql is the PostGres interactive terminal client (similar to mysql client)
<code>psql -U username -h hostnam_e _databasename</code>
Hosts: vagrant has a local PostGres database, or you can use Korra or Heroku
Using Vagrant:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>psql –U homestead -h localhost databasename
</pre></div>
</td></tr></table>
prompts for password: secret
databasename is optional. </p>
<p>We have a db called homestead or you can create own
NOTE: your db and tables on Vagrant are NOT persisted!!!
Once connected - <mark>Useful commands
<code>\list</code> (or <code>\l</code>)</mark>, lists all databases</p>
<p>We will use the homestead db
<code>\connect homestead</code> (or <code>\c homestead</code>) instead of use database
| Command| Definition|
|----------|:-------------|
| <code>\d</code>| lists all tables in the current db |
| <code>\d tablename</code> | describes a table |
| <code>\?</code> | list of available commands |
| <code>\q</code> | quit |</p>
<h2 id="once-connected-sql-queries">Once connected - SQL queries<a class="headerlink" href="#once-connected-sql-queries" title="Permanent link">&para;</a></h2>
<p>Within the psql client, every statement (SQL command) needs to be terminated by a semicolon.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">create</span> <span class="k">database</span> <span class="n">dbname</span><span class="p">;</span>
</pre></div>
</td></tr></table></p>
<p>These semicolons are an indication to the client that the query is complete and should be run.
The semicolons are not part of the SQL itself (this is a common point of confusion).</p>
<p>This means you can continue the same SQL statement over several lines within the client, which makes it easier to read and to edit</p>
<div class="admonition tip">
<p class="admonition-title">Recall</p>
<p>selecting a db: <code>\connect databasename</code></p>
</div>
<h2 id="using-php-with-postgres">Using PHP with Postgres<a class="headerlink" href="#using-php-with-postgres" title="Permanent link">&para;</a></h2>
<p>For years, PHP developers used the standard or improved MySQL functions (called the mysql or mysqli extension) database specific, not object oriented.</p>
<p>We will use PDO (PHP Data Objects) in this class to remain object-oriented
requires PostgresSQL driver to be enabled:</p>
<p>Look in <code>/etc/php/7.1/fpm/php.ini</code> for <code>php_pdo_pgsql.dll</code> installed by default with Homestead</p>
<h2 id="three-important-pdo-classes">Three important PDO classes<a class="headerlink" href="#three-important-pdo-classes" title="Permanent link">&para;</a></h2>
<h3 id="pdo-db-connection-abstraction">PDO – db connection abstraction<a class="headerlink" href="#pdo-db-connection-abstraction" title="Permanent link">&para;</a></h3>
<p>Can use directly for simple statements</p>
<h3 id="pdoexception">PDOException<a class="headerlink" href="#pdoexception" title="Permanent link">&para;</a></h3>
<p>Issues with the connection</p>
<h3 id="pdostatement">PDOStatement<a class="headerlink" href="#pdostatement" title="Permanent link">&para;</a></h3>
<p>Prepared statement with portions replaced by variables when execute.</p>
<div class="admonition tip">
<p class="admonition-title">Recall: Using classes</p>
<p>You can directly call a constructor:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SomeClass</span><span class="p">(</span><span class="nx">…</span><span class="p">);</span> <span class="c1">//allocates and initializes</span>

<span class="nv">$object</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">();</span> <span class="c1">//-&gt; is the member access operator, not .</span>

<span class="nv">$object</span><span class="o">-&gt;</span><span class="na">attribute</span><span class="p">;</span> <span class="c1">//NOT $object-&gt;$attribute</span>

<span class="nx">SomeClass</span><span class="o">::</span><span class="na">staticFunction</span><span class="p">();</span> <span class="c1">//:: is the scope resolution operator</span>

<span class="nb">unset</span><span class="p">(</span><span class="nv">$object</span><span class="p">);</span> <span class="c1">//same as $object = null, optional if you want to tag for garbage collection</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table></p>
</div>
<h2 id="pdo-php-data-objects">PDO- PHP Data Objects<a class="headerlink" href="#pdo-php-data-objects" title="Permanent link">&para;</a></h2>
<p>PDO provides a consistent way to execute queries regardless of the database application in use</p>
<p>Postgres, MySQL, SQLite, Oracle, SQLServer, …
Connect to a database:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="x">$pdo = new PDO(&#39;dataSourceName&#39;, &#39;user&#39;, &#39;password&#39;);</span>
</pre></div>
</td></tr></table></p>
<p>dataSourceName syntax: <code>driver:name1=value1;name2=value2</code></p>
<p>i.e., database application, followed by name-value pairs</p>
<p>example:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>pgsql:dbname=lab;host=localhost

mysql:dbname=lab;host=localhost
</pre></div>
</td></tr></table>
On Vagrant – <mark>make your database first!</mark></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>PGSQL is slightly different from MySQL. no <code>AUTO_INCREMENT</code> property, instead the column is defined as <code>SERIAL</code>.</p>
</div>
<p><code>SERIAL</code> indicates integer, not null with values assigned from a sequence generator
Simple statements <code>$pdo-&gt;exec($query)</code>
general syntax for simple statements that do not return result sets and have no parameters: <code>CREATE</code>, some <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="s1">&#39;CREATE TABLE employees (id INT(8), lastname varchar(25) )&#39;</span><span class="p">;</span>

<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="s1">&#39;DELETE FROM employees;&#39;</span><span class="p">;</span> <span class="c1">//no where clause, deletes all</span>

<span class="nv">$num</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span> <span class="c1">//exec returns the number of rows affected</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO customers(custName, country) VALUES (&#39;Jaya&#39;, &#39;Canada&#39;);&quot;</span><span class="p">;</span>

<span class="nv">$num</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span> <span class="c1">//1 row affected</span>

<span class="nv">$id</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span> <span class="c1">//returns the auto-incremented primary key value</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table></p>
<h2 id="issue-sql-injection">Issue: SQL Injection<a class="headerlink" href="#issue-sql-injection" title="Permanent link">&para;</a></h2>
<p>Add a user to the database:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO users (name) VALUES (&#39;</span><span class="si">$name</span><span class="s2">&#39;);&quot;</span><span class="p">;</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span> <span class="nv">$q</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>
if <code>$name</code> contains: <code>Jaya'); Drop Table users --</code>, the query will be
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">users</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Jaya&#39;</span><span class="p">);</span> <span class="k">Drop</span> <span class="k">Table</span> <span class="n">users</span> <span class="c1">--&#39;);</span>
</pre></div>
</td></tr></table>
<code>--</code> and <code>#</code>indicate SQL comment to end of line, so the <code>');</code> will be ignored</p>
<h3 id="sql-injection-another-example">SQL Injection – Another example<a class="headerlink" href="#sql-injection-another-example" title="Permanent link">&para;</a></h3>
<p>Authenticate a user:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM userinfo WHERE user= &#39;</span><span class="si">$user</span><span class="s2">&#39; AND pwd = &#39;</span><span class="si">$pwd</span><span class="s2">&#39;; &quot;</span><span class="p">;</span>

<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span> <span class="nv">$q</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>
If <code>$user</code> contains: <code>admin</code> OR <code>'1'='1'</code> and <code>$pwd</code> is empty
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">userinfo</span> <span class="k">WHERE</span> <span class="k">user</span><span class="o">=</span> <span class="s1">&#39;admin&#39;</span> <span class="k">OR</span> <span class="s1">&#39;1&#39;</span><span class="o">=</span><span class="s1">&#39;1&#39;</span> <span class="k">AND</span> <span class="n">pwd</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
</pre></div>
</td></tr></table>
<code>AND</code> has precedence over <code>OR</code>; even if the <code>AND</code> is false, if the user id is guessed correctly (ie, true), then the <code>OR</code> is true</p>
<p><mark>They can log in as admin without any privileges</mark></p>
<h3 id="why-does-it-happen">Why does it happen?<a class="headerlink" href="#why-does-it-happen" title="Permanent link">&para;</a></h3>
<p>User input is concatenated directly into a SQL statement</p>
<p>Presence of single quote <code>'</code> closes SQL string, allows additional SQL operators / statements.</p>
<p>Sanitize data and check data type - not best solution
quote function wraps the strings in quotes so you don't have to in your query:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">quote</span><span class="p">(</span><span class="nv">$unsafe_data</span><span class="p">);</span>

<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s2">&quot;INSERT INTO tablename (column1) VALUES (</span><span class="si">$data</span><span class="s2">)&quot;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table></p>
<p>User can't close the single quotes.</p>
<h3 id="best-solution-always-use-prepared-statements">Best Solution- ALWAYS use prepared statements<a class="headerlink" href="#best-solution-always-use-prepared-statements" title="Permanent link">&para;</a></h3>
<p>the query is sent as one step and the specific data is sent separately. The end result can be much better performance and easier security management.</p>
<p>To use prepared statements, start with the <code>prepare()</code> method to get a <code>PDOStatement</code>.
the query, with the dynamic data represented by placeholders (e.g., question marks, not in quotes):
<code>$stmt = $pdo-&gt;prepare('SELECT * FROM users WHERE first=? AND last=?;');</code></p>
<p>Next, invoke the <code>execute()</code> method of the <code>PDOStatement</code> object, providing to it an array of actual values (if returns a boolean)</p>
<p><code>if ($stmt-&gt;execute(array('jaya', 'nila')))</code> or
<code>if ($stmt-&gt;execute( ['jaya', 'nila']))</code></p>
<h4 id="named-placeholders">Named placeholders<a class="headerlink" href="#named-placeholders" title="Permanent link">&para;</a></h4>
<p>Named placeholders start with a colon, followed by a label:
<code>$stmt = $pdo-&gt;prepare('SELECT * FROM users WHERE first=:first AND last=:last');</code></p>
<p>Use the placeholders as keys in the array passed to the <code>execute()</code> method:
<code>$stmt-&gt;execute([':first' =&gt; 'jaya', ':last' =&gt; 'nila']);</code></p>
<p>Another example
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="s1">&#39;INSERT INTO tasks (parent_id, task) VALUES (:parent_id, :task)&#39;</span><span class="p">;</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$q</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;:parent_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$parent_id</span><span class="p">,</span> <span class="s1">&#39;:task&#39;</span> <span class="o">=&gt;</span> <span class="nv">$task</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;The task has been added!&#39;</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;The task could not be added.&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>
The <code>execute()</code> method returns a boolean indicating its success</p>
<div class="admonition tip">
<p class="admonition-title">Recall</p>
<p>DO NOT insert auto incremented columns</p>
</div>
<h4 id="binding-parameters-to-reuse-statements">Binding parameters to reuse statements<a class="headerlink" href="#binding-parameters-to-reuse-statements" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span> <span class="p">(</span><span class="s2">&quot;INSERT INTO REGISTRY (name, value) VALUES (:name, :value)&quot;</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s1">&#39;:name&#39;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span> <span class="c1">//binds the variable $name to the placeholder</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s1">&#39;:value&#39;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span> <span class="c1">//binds the variable $value to the placeholder</span>

<span class="c1">// insert one row</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="s1">&#39;one&#39;</span><span class="p">;</span>
<span class="nv">$value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="c1">// insert another row with different values</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="s1">&#39;two&#39;</span><span class="p">;</span>
<span class="nv">$value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="nx">Example</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM users WHERE first=?AND last=?&#39;</span><span class="p">;</span> <span class="c1">//not named placeholder</span>

<span class="k">try</span> <span class="p">{</span>

<span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;pgsql:dbname= test;host=localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span>

<span class="s1">&#39;password&#39;</span><span class="p">);</span>

<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span> <span class="c1">//Ensures exceptions are thrown</span>

<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>

<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$first</span><span class="p">);</span> <span class="c1">//BEWARE : 1 indexed!!!</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$last</span><span class="p">);</span>

<span class="c1">//in a loop, I could keep changing $first and $last</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">()</span> <span class="p">)</span> <span class="c1">//returns a Boolean</span>

<span class="c1">//yay!</span>

<span class="k">else</span>

<span class="c1">// boo!!</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>

<span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>

<span class="nb">unset</span><span class="p">(</span><span class="nv">$pdo</span><span class="p">);</span> <span class="c1">//not required, connection is closed when script ends</span>

<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>

<h5 id="bindparam-vs-bindvalue">bindParam vs bindValue<a class="headerlink" href="#bindparam-vs-bindvalue" title="Permanent link">&para;</a></h5>
<p><code>bindParam</code> requires the variable to be passed by reference. It must be a variable since it is bound to the placeholder.</p>
<ul>
<li>very useful when you prepare your statement outside the loop, and simply change variable values in the loop</li>
</ul>
<p><code>bindValue</code> is used when you are passing by value
* It can be used for calculated values, method calls, constants or literals, etc
* need to re-bind on every iteration through the loop since it is copied by value</p>
<p>Queries that return results <code>execute()</code> method returns a Boolean indicating its success</p>
<p>Fetching data:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$dbh</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM REGISTRY where name = ?&quot;</span><span class="p">);</span>

<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span>
<span class="nv">$name</span><span class="o">=</span><span class="s1">&#39;php&#39;</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">())</span> <span class="p">{</span> <span class="c1">//fetch() returns an associative array by default</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>
=&gt; the key is the column name and the value is the row value</p>
<h2 id="fetch-methods-and-styles">Fetch methods and styles<a class="headerlink" href="#fetch-methods-and-styles" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Methods/Styles</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fetch</code></td>
<td align="left">returns one row at a time</td>
</tr>
<tr>
<td><code>fetchAll</code></td>
<td align="left">returns an array containing all the result rows in the style specified</td>
</tr>
<tr>
<td><code>setFetchMode(PDO:: FETCH_ASSOC)</code></td>
<td align="left">fetch styles that can be specified</td>
</tr>
<tr>
<td><code>PDO::FETCH_ASSOC</code></td>
<td align="left">for an associative array -&gt; default, both numeric and associative</td>
</tr>
<tr>
<td><code>PDO::FETCH_NUM</code></td>
<td align="left">for a numerically indexed array</td>
</tr>
<tr>
<td><code>PDO::FETCH_OBJ</code></td>
<td align="left">for a generic object (anonymous type) with property names being the column names</td>
</tr>
<tr>
<td><code>PDO::FETCH_CLASS</code></td>
<td align="left">for a specific type of object, use with <code>FETCH_PROPS_LATE</code>, mapping column names to properties</td>
</tr>
<tr>
<td><code>PDO::FETCH_PROPS_LATE</code></td>
<td align="left">mapping column names to properties</td>
</tr>
</tbody>
</table>
<h3 id="examples-in-an-array">Examples – in an array<a class="headerlink" href="#examples-in-an-array" title="Permanent link">&para;</a></h3>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT id, name FROM users&quot;</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">()))</span> <span class="p">{</span> <span class="c1">//Default – associative array</span>
    <span class="c1">// Use $row[&#39;id&#39;] for the id.</span>
    <span class="c1">// Use $row[&#39;name&#39;] for the username.</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>
or</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">();</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$results</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Use $row[&#39;id&#39;] for the id.</span>
    <span class="c1">// Use $row[&#39;name&#39;] for the username.</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>

<h3 id="example-object">Example - object<a class="headerlink" href="#example-object" title="Permanent link">&para;</a></h3>
<p>The returned records be turned into specific types of objects:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">User</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="nx">getName</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>
Fetch database records into new User objects:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$q</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT id, name FROM users&quot;</span><span class="p">);</span>
<span class="nv">$q</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span><span class="nv">$q</span><span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">(</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_CLASS</span><span class="o">|</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_PROPS_LATE</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$row</span><span class="o">-&gt;</span><span class="na">getUsername</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>
<code>$row</code> will be a <code>User</code> object, and it can invoke the <code>User</code> methods.</p>
<h2 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">&para;</a></h2>
<p>PHP directly maps the returned column names to matching object attributes even if they are private.</p>
<p>If no comparable class attribute exists, PHP will create the column name as a new public attribute!!!</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>The constructor is called after the attributes are set ?!! So either no constructor in your data transfer class, or use <code>$q-&gt;fetch(PDO::FETCH_CLASS|PDO::FETCH_PROPS_LATE, 'User'))</code> -&gt; constructor is executed before PDO assigns the object attributes</p>
</div>
<h2 id="column-name-to-attribute-name-mapping">Column name to Attribute name mapping<a class="headerlink" href="#column-name-to-attribute-name-mapping" title="Permanent link">&para;</a></h2>
<p>sql aliases are used to map the sql query result to the appropriate object attribute
you can force column names (and aliases) to a specific case pattern</p>
<p>default will be all lower case
<code>$pdo-&gt;setAttribute(PDO::ATTR_CASE, PDO::CASE_NATURAL );</code></p>
<p><code>PDO::ATTR_CASE</code> – forces columns to a case pattern</p>
<p><code>PDO::CASE_NATURAL</code> leaves them as they are returned</p>
<p>since we use an alias, the alias is used as is
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">Category</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$fkId</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$shortName</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$longName</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_CASE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">CASE_NATURAL</span> <span class="p">);</span> 

<span class="c1">//use an SQL alias</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span>
    <span class="s1">&#39;SELECT</span>
<span class="s1">        id,</span>
<span class="s1">        fk\_id AS `fkId`,</span>
<span class="s1">        short\_name AS `shortName`,</span>
<span class="s1">        long\_name As `longName`</span>
<span class="s1">    FROM `Category`;&#39;</span>
<span class="p">);</span>
<span class="nv">$stmt</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table></p>
<h2 id="sql-review-inserting-records">SQL Review - Inserting records<a class="headerlink" href="#sql-review-inserting-records" title="Permanent link">&para;</a></h2>
<h3 id="named-columns">Named columns:<a class="headerlink" href="#named-columns" title="Permanent link">&para;</a></h3>
<p>Don't insert the auto-increment columns
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">tablename</span> <span class="p">(</span><span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="err">…</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="err">…</span><span class="p">)</span>
</pre></div>
</td></tr></table></p>
<h3 id="unnamed-columns">Unnamed columns:<a class="headerlink" href="#unnamed-columns" title="Permanent link">&para;</a></h3>
<p>All columns must be given in order of columns in the table</p>
<ul>
<li>in that case, value NULL for the auto-incremented column
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">tablename</span> <span class="k">VALUES</span> <span class="p">(</span><span class="k">NULL</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">...)</span>
</pre></div>
</td></tr></table></li>
</ul>
<h2 id="example-crud-create">Example CRUD - Create<a class="headerlink" href="#example-crud-create" title="Permanent link">&para;</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;pgsql:host=localhost;dbname=homestead&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>

    <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
    <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">&#39;INSERT INTO mytable VALUES(NULL, ?)&#39;</span><span class="p">);</span>

    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span>
    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

    <span class="c1">// Affected Rows?</span>
    <span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span> <span class="c1">// 1</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="k">echo</span> <span class="s1">&#39;Error: &#39;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>

<h2 id="update-and-delete-records">Update and delete records<a class="headerlink" href="#update-and-delete-records" title="Permanent link">&para;</a></h2>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">UPDATE</span> <span class="n">tablename</span> <span class="k">SET</span> <span class="n">column1</span><span class="o">=</span><span class="n">value1</span><span class="p">,</span> <span class="n">column2</span><span class="o">=</span><span class="n">value2</span> <span class="k">WHERE</span> <span class="n">condition</span>
</pre></div>
</td></tr></table>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">tablename</span> <span class="k">WHERE</span> <span class="n">condition</span> <span class="k">LIMIT</span> <span class="n">num</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="k">g</span><span class="p">.,</span> <span class="k">only</span> <span class="mi">1</span> <span class="k">row</span><span class="p">)</span>
</pre></div>
</td></tr></table>
All rows:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">TRUNCATE</span> <span class="k">TABLE</span> <span class="n">tablename</span>
</pre></div>
</td></tr></table>
Entire table:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">tablename</span>
</pre></div>
</td></tr></table></p>
<h3 id="example-crud-update">Example CRUD - Update<a class="headerlink" href="#example-crud-update" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="nv">$name</span> <span class="o">=</span> <span class="s2">&quot;Joe&quot;</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>

<span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;pgsql:host=localhost;dbname=homestead&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>

<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>

<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">&#39;UPDATE mytable SET name = :name WHERE id = :id&#39;</span><span class="p">);</span>

<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s1">&#39;:name&#39;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_STR</span><span class="p">);</span> <span class="c1">//default</span>

<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s1">&#39;:id&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">);</span> <span class="c1">// PDO::PARAM_INT will have no quotes in the sql query, usually just needed for limit clauses</span>

<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span> <span class="c1">// 1</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="k">echo</span> <span class="s1">&#39;Error: &#39;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>

<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>

<h3 id="example-crud-delete">Example CRUD - Delete<a class="headerlink" href="#example-crud-delete" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// From a form or something similar</span>

<span class="k">try</span> <span class="p">{</span>

<span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;pgsql:host=localhost;dbname=someDatabase&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>

<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>

<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">&#39;DELETE FROM mytable WHERE id = :id&#39;</span><span class="p">);</span>

<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s1">&#39;:id&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>

<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span> <span class="c1">// 1</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="k">echo</span> <span class="s1">&#39;Error: &#39;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>

<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>

<h2 id="selecting-data">Selecting data<a class="headerlink" href="#selecting-data" title="Permanent link">&para;</a></h2>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">columns</span> <span class="k">FROM</span> <span class="n">tablename</span> <span class="k">WHERE</span> <span class="n">condition</span>
</pre></div>
</td></tr></table>
conditions:
- equality (e.g., date = '2012-01-26')
- range (e.g., price BETWEEN 10.0 AND 20.0)
- relative (e.g., quantity &gt; 5)
- wildcard LIKE (name LIKE '%Smith%' )</p>
<h3 id="using-a-wildcard-in-a-prepared-statement">Using a wildcard in a prepared statement:<a class="headerlink" href="#using-a-wildcard-in-a-prepared-statement" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">&#39;SELECT columns FROM table WHERE column LIKE ? &#39;</span><span class="p">);</span>

<span class="nv">$stmt</span><span class="o">-&gt;</span> <span class="na">bindValue</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$search</span><span class="o">.</span><span class="s1">&#39;%&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>

<h2 id="concatentation-operator">Concatentation operator<a class="headerlink" href="#concatentation-operator" title="Permanent link">&para;</a></h2>
<p>Example:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">last_name</span> <span class="o">||</span> <span class="s1">&#39;, &#39;</span> <span class="o">||</span> <span class="n">first_name</span>

<span class="k">FROM</span> <span class="n">users</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="n">last_name</span> <span class="o">||</span> <span class="s1">&#39;, &#39;</span> <span class="o">||</span> <span class="n">first_name</span> <span class="k">AS</span> <span class="n">Name</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Name</span><span class="p">;</span>
</pre></div>
</td></tr></table></p>
<h2 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h2>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">FUNCTION</span><span class="p">(</span><span class="k">column</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">tablename</span>

<span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="k">FUNCTION</span><span class="p">(</span><span class="n">column2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">blah</span><span class="p">,</span> <span class="n">column3</span> <span class="k">FROM</span> <span class="n">tablename</span>
</pre></div>
</td></tr></table>
Examples:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">lower</span><span class="p">(</span><span class="n">title</span><span class="p">),</span> <span class="k">trim</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">books</span><span class="p">;</span>
</pre></div>
</td></tr></table></p>
<h2 id="sorting">Sorting<a class="headerlink" href="#sorting" title="Permanent link">&para;</a></h2>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">tablename</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">column</span> <span class="k">DESC</span><span class="p">,</span> <span class="n">column2</span>
</pre></div>
</td></tr></table>
Text sorting depends on collation</p>
<ul>
<li><code>COLLATION</code> dictates how values are compared and sorted</li>
<li>Tied to the character set (language support)</li>
<li>Takes into account cultural habits</li>
<li>Case-sensitive or insensitive</li>
<li>Count accents or not?</li>
</ul>
<h2 id="grouping-results">Grouping results<a class="headerlink" href="#grouping-results" title="Permanent link">&para;</a></h2>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">products</span> <span class="k">WHERE</span> <span class="n">condition</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">name</span>
</pre></div>
</td></tr></table>
* each product name occurs only once
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="k">avg</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">products</span> <span class="k">WHERE</span> <span class="n">condition</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">name</span>
</pre></div>
</td></tr></table>
Aggregate functions used for anything not grouped
* e.g., <code>MAX</code>, <code>MIN</code>, <code>COUNT</code>, <code>SUM</code></p>
<h3 id="distinct">Distinct<a class="headerlink" href="#distinct" title="Permanent link">&para;</a></h3>
<p><code>DISTINCT</code> – provides unique values
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">customer_ID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">accounts</span>

<span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">balance</span><span class="p">),</span> <span class="n">customer_id</span> <span class="k">FROM</span> <span class="n">accounts</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">customer_id</span>
</pre></div>
</td></tr></table></p>
<h2 id="joins">Joins<a class="headerlink" href="#joins" title="Permanent link">&para;</a></h2>
<p>Inner join, outer join on one, two, or more tables
self join is possible – use aliases
* normally use primary key and foreign key columns, but not always
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">columns</span> <span class="k">FROM</span> <span class="n">tableA</span> <span class="n">JOIN_TYPE</span> <span class="n">tableB</span> <span class="n">JOIN_CONDITION</span> <span class="k">WHERE</span> <span class="n">conditions</span>
</pre></div>
</td></tr></table>
columns can be <code>tablename.column</code> to prevent ambiguity</p>
<ul>
<li><code>JOIN_TYPE: INNER JOIN table2 AS t2</code></li>
<li><code>JOIN_CLAUSE: ON conditions</code></li>
</ul>
<h3 id="types-of-joins">Types of joins<a class="headerlink" href="#types-of-joins" title="Permanent link">&para;</a></h3>
<h4 id="inner-join">INNER JOIN<a class="headerlink" href="#inner-join" title="Permanent link">&para;</a></h4>
<p>exclusive</p>
<ul>
<li>Returns all rows when there is at least one match in BOTH tables</li>
<li>produces a Cartesian product between the specified tables (that is, each and every row in the first table is joined to each and every row in the second table).</li>
</ul>
<h4 id="outer-join">OUTER JOIN:<a class="headerlink" href="#outer-join" title="Permanent link">&para;</a></h4>
<p>inclusive</p>
<h5 id="left-join">LEFT JOIN<a class="headerlink" href="#left-join" title="Permanent link">&para;</a></h5>
<p>Return all rows from the left table, and the matched rows from the right table (or <code>NULL</code> if no matching rows in right table)</p>
<ul>
<li>in PostgreSQL: <code>JOIN</code> is equivalent to <code>INNER JOIN</code></li>
<li><code>LEFT</code>, <code>RIGHT</code> or <code>FULL</code> indicate <code>OUTER JOIN</code></li>
</ul>
<h3 id="join-on-vs-where-conditions">JOIN ON vs WHERE conditions<a class="headerlink" href="#join-on-vs-where-conditions" title="Permanent link">&para;</a></h3>
<p>The conditional_expr used with <code>ON</code> is any conditional expression of the form that can be used in a <code>WHERE</code> clause.</p>
<p>Generally, you should use the <code>ON</code> clause for conditions that specify how to join tables
and the <code>WHERE</code> clause to restrict which rows you want in the result set.</p>
<h2 id="limiting-results">Limiting results<a class="headerlink" href="#limiting-results" title="Permanent link">&para;</a></h2>
<p>e.g., only top 25:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">tablename</span> <span class="k">WHERE</span> <span class="n">conditions</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">column</span> <span class="k">LIMIT</span> <span class="mi">25</span>
</pre></div>
</td></tr></table>
One argument = value specifies the number of rows from the beginning of the result set
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">tablename</span> <span class="k">WHERE</span> <span class="n">conditions</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">column</span> <span class="k">LIMIT</span> <span class="n">num</span> <span class="k">OFFSET</span> <span class="n">skip</span>
</pre></div>
</td></tr></table>
Two arguments = the first argument specifies the number of rows to return, and the second specifies the number of rows to skip.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">tbl</span> <span class="k">LIMIT</span> <span class="mi">5</span> <span class="k">OFFSET</span> <span class="mi">10</span><span class="p">;</span> <span class="o">#</span> <span class="n">Retrieve</span> <span class="k">rows</span> <span class="mi">11</span><span class="o">-</span><span class="mi">16</span>
</pre></div>
</td></tr></table>
* If you use <code>LIMIT</code>, almost always use <code>ORDER BY</code>
* Large offsets: performance issues are possible
    * Database still has to calculate the rows skipped by the offset even if they are not returned</p>
<h2 id="limit">LIMIT<a class="headerlink" href="#limit" title="Permanent link">&para;</a></h2>
<p>The higher the offset is, the longer the query is even if the number of rows retrieved is the same
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">largetable</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="s1">&#39;id&#39;</span> <span class="k">LIMIT</span> <span class="mi">50</span> <span class="k">OFFSET</span> <span class="mi">0</span> <span class="k">is</span> <span class="n">faster</span> <span class="k">than</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">largetable</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="s1">&#39;id&#39;</span> <span class="k">LIMIT</span> <span class="mi">50</span> <span class="k">OFFSET</span> <span class="mi">1000000</span>
</pre></div>
</td></tr></table>
* Second query is the same as saying – select * from the first 1000050 rows that match the criteria and give the last 50
* You still have to perform all the matches to know that you are at the end
* Even if you use indices, the query can be long since the many rows must be found</p>
<h3 id="solution-if-the-order-by-is-sorted-by-unique-keys">Solution: If the Order By is sorted by unique keys<a class="headerlink" href="#solution-if-the-order-by-is-sorted-by-unique-keys" title="Permanent link">&para;</a></h3>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">largetable</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">&gt;</span> <span class="n">lastID</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="s1">&#39;id&#39;</span> <span class="k">LIMIT</span> <span class="mi">50</span>
</pre></div>
</td></tr></table>
This assumes you know the lastID that was requested
this assumes no holes in the ids:
e.g. in a Paginated set: <code>lastID = (pageNumber - 1) * records/page</code></p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../midterm_prep/" title="Midterm prep" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Midterm prep
              </span>
            </div>
          </a>
        
        
          <a href="../assignments/dont-eat-that/" title="Dont eat that" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Dont eat that
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-c35428f87f.js"></script>
      
      
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>